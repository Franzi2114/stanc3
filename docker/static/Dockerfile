# Based on a Dockerfile autogenerated by OCaml-Dockerfile scripts
FROM alpine:3.8

#Define distro_style and install OS dependencies
LABEL distro_style="apk"

#Install os dependencies
RUN apk update && apk add build-base bzip2 git tar curl ca-certificates openssl m4 bash

#Init opam and switch to 4.07
RUN opam init -y --disable-sandboxing
RUN opam switch create 4.07 ocaml-base-compiler.4.07.1 && \
  opam switch 4.07

# Copy script and install build dependencies
COPY ./scripts/install_build_deps.sh ./
RUN bash -x install_build_deps.sh

#Define our entrypoint
ENTRYPOINT [ "opam", "config", "exec", "--" ]